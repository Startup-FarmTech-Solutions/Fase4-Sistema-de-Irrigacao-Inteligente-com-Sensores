# FIAP - Faculdade de Inform√°tica e Administra√ß√£o Paulista 

<p align="center">
  <a href="https://www.fiap.com.br/">
    <img src="assets/logo-fiap.png" alt="FIAP" width="40%">
  </a>
</p>


<br>

# üå± FarmTech Solutions - Sistema de Irriga√ß√£o Inteligente
## üë®‚Äçüéì Integrantes: 
- Vitor Eiji Fernandes Teruia
```
- RM: rm563683
- E-mail: vitorfer2018@gmail.com
- GitHub: [@Vitor985-hub](https://github.com/Vitor985-hub)
```
- Beatriz Pilecarte de Melo
```
 - RM: rm564952
 - E-mail: beatrizpilecartedemelo@gmail.com
 - GitHub: [@BPilecarte](https://github.com/BPilecarte)
```
- Francismar Alves Martins Junior
```
 - RM: m562869
 - E-mail: yggdrasil.git@gmail.com
 - GitHub: [@yggdrasilGit](https://github.com/yggdrasilGit
```
- Ant√¥nio Ancelmo Neto barros
```
 - RM: rm563683
 - E-mail: antonio.anbarros@gmail.com
 - GitHub: [@AntonioBarros19](https://github.com/AntonioBarros19)
```
- Matheus Soares Bento da Silva
```
 - RM: rm565540
 - E-mail: matheusbento044@gmail.com
 - GitHub: [matheusbento044](https://github.com/matheusbento04)
```

## üë©‚Äçüè´ Professores:
### Tutor(a) 
- <a href="https://www.linkedin.com/in/leonardoorabona/">Leonardo Ruiz Orabona</a>
### Coordenador(a)
- <a href="https://www.linkedin.com/company/inova-fusc">ANDR√â GODOI CHIOVATO</a>


# üåæ Sistema de Irriga√ß√£o Inteligente com Sensores e ML

## üìú Descri√ß√£o

Este projeto desenvolve um sistema de irriga√ß√£o inteligente, integrando simula√ß√µes de hardware em **Wokwi** (com um microcontrolador **ESP32**) e um backend robusto em **Python**. O sistema coleta dados simulados de sensores de solo (umidade, pH, f√≥sforo e pot√°ssio), utiliza um **modelo de Machine Learning (KNN)** para sugest√µes de irriga√ß√£o, armazena os dados em um banco de dados **SQLite**, e fornece visualiza√ß√£o atrav√©s de um **dashboard Streamlit**. Al√©m disso, incorpora dados clim√°ticos reais via **API OpenWeather** para otimizar as decis√µes de irriga√ß√£o.

## üöÄ Funcionalidades Principais

* **Coleta de Dados Simulada:** Sensores de solo (umidade, pH, f√≥sforo, pot√°ssio) simulados no Wokwi com ESP32.
* **Controle de Irriga√ß√£o Automatizado:** Rel√© simulado para acionamento da bomba de irriga√ß√£o baseado em crit√©rios de umidade, nutrientes, pH e condi√ß√µes clim√°ticas.
* **Modelo Preditivo (Machine Learning):** Integra√ß√£o de um modelo KNN para fornecer sugest√µes inteligentes sobre o status da irriga√ß√£o (Ativa/Inativa) com base nos dados dos sensores.
* **Persist√™ncia de Dados:** Armazenamento cont√≠nuo dos dados dos sensores em um banco de dados SQLite.
* **Visualiza√ß√£o Interativa:** Dashboard interativo constru√≠do com Streamlit para monitoramento em tempo real dos dados do solo e do status da irriga√ß√£o, incluindo a previs√£o do modelo.
* **Integra√ß√£o Clim√°tica:** Consulta √† API do OpenWeather para obter dados clim√°ticos (temperatura, chuva) e ajustar a l√≥gica de irriga√ß√£o.
* **Interface LCD:** Exibi√ß√£o dos dados dos sensores e status da irriga√ß√£o diretamente no display LCD simulado.

---

## üîß Tecnologias Utilizadas

* **Hardware / Simula√ß√£o:**
    * **ESP32:** Microcontrolador principal.
    * **Wokwi.com:** Plataforma de simula√ß√£o online para o circuito do ESP32 e sensores.
    * **C/C++:** Linguagem de programa√ß√£o para o firmware do ESP32 (`main.ino`).
* **Backend / An√°lise:**
    * **Python 3:** Linguagem principal para scripts de backend, ML e dashboard.
    * **SQLite:** Banco de dados local para armazenamento de dados de sensores.
    * **Bibliotecas Python:**
        * `pyserial`: Comunica√ß√£o serial com o ESP32 (simulada ou real).
        * `scikit-learn`: Para o desenvolvimento e uso do modelo KNN.
        * `streamlit`: Desenvolvimento do dashboard interativo.
        * `requests`: Para integra√ß√£o com a API clim√°tica.
        * Outras bibliotecas para manipula√ß√£o de dados e conex√£o com DB.
    * **API P√∫blica:** OpenWeather (https://openweathermap.org/api) para dados clim√°ticos.

---

## üß† L√≥gica do Projeto

### Sensores e Atuadores Simulados (Wokwi)

| Sensor/Atuador | Componente Simulado | Tipo de Valor | Descri√ß√£o |
| :------------- | :------------------ | :------------ | :------------------------------------------------ |
| Umidade        | DHT22               | Anal√≥gico     | Mede a umidade do solo e temperatura do ambiente. |
| F√≥sforo (P)    | Bot√£o f√≠sico        | Booleano      | Simula a adi√ß√£o/presen√ßa de f√≥sforo no solo.      |
| Pot√°ssio (K)   | Bot√£o f√≠sico        | Booleano      | Simula a adi√ß√£o/presen√ßa de pot√°ssio no solo.     |
| pH             | LDR (sensor de luz) | Anal√≥gico     | Representa varia√ß√£o cont√≠nua do pH do solo.       |
| Bomba Irriga√ß√£o| Rel√© + LED          | Booleano      | Atuador que simula o controle da bomba. O LED indica o status. |

### Fluxo de Dados e Processamento

1.  **Leitura do ESP32 (`main.ino`):** O firmware do ESP32 no Wokwi l√™ os dados dos sensores DHT22 (umidade/temperatura), LDR (pH), e os estados dos bot√µes (f√≥sforo/pot√°ssio).
2.  **Envio Serial:** Os dados s√£o enviados do ESP32 para o computador (simulado) via comunica√ß√£o serial.
3.  **Coleta Python (`main.py`):** Um script Python (`main.py`) l√™ esses dados da porta serial, processa-os e os salva no arquivo `console_print.csv`.
4.  **Integra√ß√£o Clim√°tica (`api_climatica.py`):** O script `api_climatica.py` consulta a API do OpenWeather para obter informa√ß√µes sobre a temperatura e precipita√ß√£o em S√£o Paulo.
    * **L√≥gica de Irriga√ß√£o Inteligente:**
        * Se houver previs√£o de chuva ou chuva recente, a irriga√ß√£o √© evitada.
        * Se a temperatura ambiente estiver acima de 30¬∞C e n√£o houver previs√£o de chuva, a irriga√ß√£o √© mais prov√°vel.
        * Caso contr√°rio, a irriga√ß√£o ocorre conforme as outras regras de umidade/nutrientes.
5.  **Modelo de Machine Learning (`modelagem_ml.ipynb` e `ml/models/`):**
    * Um notebook Jupyter (`modelagem_ml.ipynb`) √© usado para treinar um modelo de Classifica√ß√£o (KNN) com base em dados hist√≥ricos de sensores e decis√µes de irriga√ß√£o.
    * O modelo treinado (`modelo_irrigacao_knn.pkl`) e seu `scaler` (`scaler_irrigacao.pkl`) s√£o salvos e carregados pelo dashboard.
6.  **Dashboard Streamlit (`dashboard/app.py`):**
    * L√™ os dados mais recentes do `console_print.csv`.
    * Carrega o modelo de ML para fazer previs√µes em tempo real sobre a necessidade de irriga√ß√£o.
    * Exibe gr√°ficos e indicadores do status dos sensores, dos nutrientes, do pH e da previs√£o de irriga√ß√£o do modelo.
    * Compara a sugest√£o do modelo com o status real da irriga√ß√£o.

---

## üßæ Crit√©rios de Acionamento da Bomba (L√≥gica do Firmware e Backend)

A bomba de irriga√ß√£o √© controlada tanto pela l√≥gica interna do ESP32 (baseada na umidade) quanto pela l√≥gica mais avan√ßada do script Python que considera m√∫ltiplos fatores:

* **Umidade:** A bomba √© ligada se a umidade do solo estiver abaixo de um limite m√≠nimo (ex: 40%).
* **Nutrientes (P e K):** A presen√ßa de nutrientes (simulada pelos bot√µes) influencia a decis√£o.
* **pH:** O valor de pH (simulado via LDR) √© considerado dentro de uma faixa ideal.
* **Condi√ß√µes Clim√°ticas:** Dados da API OpenWeather s√£o utilizados para sobrepor a decis√£o:
    * **Prioridade:** Se houver previs√£o de chuva ou chuva recente, a irriga√ß√£o √© geralmente *desativada*, independentemente das condi√ß√µes do solo.
    * **Refor√ßo:** Se a temperatura estiver muito alta (>30¬∞C) e n√£o houver chuva, a irriga√ß√£o pode ser incentivada.

---

## üñº Imagens dos Circuitos (Simula√ß√£o Wokwi)

Aqui est√£o as visualiza√ß√µes dos circuitos individuais e do principal no simulador Wokwi.

### Sensor Solo
<img src="assets/imagens_dos_circuitos/sensor_solo.png" alt="Sensor solo" width="300">

#### Resultado serial plotter

![image](https://github.com/user-attachments/assets/c22a73a5-78c1-4ef1-97bf-b373c88f5104)

![image](https://github.com/user-attachments/assets/05dd1e59-aadb-4bf4-bec3-8e6d8e96effb)

![image](https://github.com/user-attachments/assets/5534d0d8-1ee8-4cc1-91af-d411cea5951e)

**Cores das Linhas**
- Roxa: pH
- Laranja: Leitura do LDR (simbolizando indiretamente o pH)
- Verde: Umidade
- Amarelo: F√≥sforo
- Branco: Temperatura

1. Leitura LDR (Laranja)
Padr√£o observado: Curva decrescente exponencial at√© se estabilizar pr√≥ximo a zero.

**Interpreta√ß√£o:** Como o LDR simula o sensor de pH, essa queda brusca pode estar simulando uma redu√ß√£o de luminosidade ‚Äî resultando num aumento de pH (que √© o que a curva roxa mostra).

2. pH (Roxa)
Padr√£o observado: Est√°vel, com leves oscila√ß√µes, mas mantendo-se numa faixa entre aproximadamente 6.5 e 8.

**Interpreta√ß√£o:** Mesmo com a grande varia√ß√£o do LDR, o pH resultante (calculado com uma pequena varia√ß√£o aleat√≥ria + constrain) est√° suavizado. A estabilidade √© desej√°vel para evitar ru√≠do no gr√°fico, e indica que o c√°lculo com constrain() + random est√° funcionando como esperado.

3. Umidade (Verde)
Padr√£o observado: Muito baixa, quase no ch√£o (linha quase constante no valor m√≠nimo).

**Interpreta√ß√£o:** A umidade lida pelo DHT22 est√° possivelmente retornando NaN ou um valor muito baixo.

4. F√≥sforo (Amarelo)
Padr√£o observado: Quase constante, pr√≥ximo de zero.

**Interpreta√ß√£o:** O bot√£o para aumentar f√≥sforo (PINO_FOSFORO) possivelmente n√£o foi pressionado. Como ele s√≥ aumenta no loop ao pressionar esse bot√£o, o valor permanece est√°tico.

5. Temperatura (Branca)
Padr√£o observado: Uma linha muito fina e reta pr√≥xima do eixo inferior, quase invis√≠vel.

##  Dashboard

![image](https://github.com/user-attachments/assets/ca1dac1e-603a-4830-b15f-0b0bfa18db39)

![image](https://github.com/user-attachments/assets/f1ea67f2-f315-42cd-ac4e-a5cb56b8c5e1)

![image](https://github.com/user-attachments/assets/f24df726-57c7-4297-b60e-8cef4d318b97)

![image](https://github.com/user-attachments/assets/8894cbf2-f37a-4d4e-9359-9338c1430303)

![image](https://github.com/user-attachments/assets/59dc8181-f631-452a-8203-296a47e30723)

---

## üìÅ Estrutura de Pastas
``
FASE4-SISTEMA-DE-IRRIGACAO-INTELIGENTE-C
‚îÇ
‚îú‚îÄ‚îÄ pycache/             # Cache de bytecode Python
‚îú‚îÄ‚îÄ .git/                    # Reposit√≥rio Git
‚îú‚îÄ‚îÄ .venv/                   # Ambiente virtual Python (recomendado)
‚îú‚îÄ‚îÄ .vscode/                 # Configura√ß√µes do VS Code
‚îú‚îÄ‚îÄ assets/                  # Ativos do projeto (imagens, logos)
‚îÇ   ‚îî‚îÄ‚îÄ imagens_dos_circuitos/ # Imagens dos circuitos Wokwi
‚îÇ       ‚îú‚îÄ‚îÄ sensor_solo.png
‚îÇ       ‚îú‚îÄ‚îÄ captura-umidade.png
‚îÇ       ‚îú‚îÄ‚îÄ sensor_fosforo.png
‚îÇ       ‚îú‚îÄ‚îÄ sensor_ph.png
‚îÇ       ‚îî‚îÄ‚îÄ sensor_potassio.png
‚îÇ   ‚îî‚îÄ‚îÄ logo-fiap.png
‚îÇ
‚îú‚îÄ‚îÄ connection/              # M√≥dulos para conex√£o com banco de dados
‚îÇ   ‚îú‚îÄ‚îÄ pycache/
‚îÇ   ‚îú‚îÄ‚îÄ init.py
‚îÇ   ‚îî‚îÄ‚îÄ connection_db.py     # L√≥gica de conex√£o com SQLite
‚îÇ
‚îú‚îÄ‚îÄ controller/              # L√≥gica de controle e manipula√ß√£o de dados
‚îÇ   ‚îú‚îÄ‚îÄ pycache/
‚îÇ   ‚îú‚îÄ‚îÄ init.py
‚îÇ   ‚îú‚îÄ‚îÄ area_plantio_controller.py
‚îÇ   ‚îú‚îÄ‚îÄ cultura_controller.py
‚îÇ   ‚îî‚îÄ‚îÄ sensor_controller.py # Controladores para interagir com os modelos e DB
‚îÇ
‚îú‚îÄ‚îÄ dashboard/               # Aplica√ß√£o de visualiza√ß√£o (Streamlit)
‚îÇ   ‚îú‚îÄ‚îÄ pycache/
‚îÇ   ‚îú‚îÄ‚îÄ init.py
‚îÇ   ‚îî‚îÄ‚îÄ app.py               # Script principal do dashboard Streamlit
‚îÇ
‚îú‚îÄ‚îÄ data/                    # Dados brutos ou tempor√°rios do sistema
‚îÇ   ‚îî‚îÄ‚îÄ console_print.json   # (Antigo: arquivo JSON dos dados do console)
‚îÇ
‚îú‚îÄ‚îÄ ml/                      # M√≥dulos e notebooks de Machine Learning
‚îÇ   ‚îú‚îÄ‚îÄ .ipynb_checkpoints/  # Checkpoints de notebooks Jupyter
‚îÇ   ‚îú‚îÄ‚îÄ models/              # Modelos ML treinados e scalers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modelo_irrigacao_knn.pkl
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ scaler_irrigacao.pkl
‚îÇ   ‚îú‚îÄ‚îÄ console_print.csv    # (Novo: dados do console coletados em CSV)
‚îÇ   ‚îî‚îÄ‚îÄ modelagem_ml.ipynb   # Notebook Jupyter para treinamento do modelo ML
‚îÇ
‚îú‚îÄ‚îÄ model/                   # Modelos de dados para o banco de dados
‚îÇ   ‚îú‚îÄ‚îÄ pycache/
‚îÇ   ‚îú‚îÄ‚îÄ init.py
‚îÇ   ‚îú‚îÄ‚îÄ area_plantio_model.py
‚îÇ   ‚îú‚îÄ‚îÄ correcao_model.py
‚îÇ   ‚îú‚îÄ‚îÄ cultura_model.py
‚îÇ   ‚îú‚îÄ‚îÄ leitura_sensor_model.py
‚îÇ   ‚îî‚îÄ‚îÄ sensor_model.py
‚îÇ
‚îú‚îÄ‚îÄ sensor_solo/             # C√≥digo do firmware ESP32 e arquivos de simula√ß√£o Wokwi
‚îÇ   ‚îú‚îÄ‚îÄ .vscode/
‚îÇ   ‚îú‚îÄ‚îÄ src/                 # C√≥digo-fonte principal do firmware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.ino         # Firmware C/C++ para ESP32 (Wokwi)
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îú‚îÄ‚îÄ diagram.json         # Configura√ß√£o do circuito no Wokwi
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Script Python para interagir com o Wokwi/ESP32 (Coleta de dados serial)
‚îÇ   ‚îú‚îÄ‚îÄ platformio.ini       # Configura√ß√£o do PlatformIO (se usado fora do Wokwi)
‚îÇ   ‚îú‚îÄ‚îÄ python-installer.exe # Instalador Python (pode ser removido se desnecess√°rio)
‚îÇ   ‚îî‚îÄ‚îÄ wokwi.toml           # Configura√ß√µes do Wokwi
‚îÇ
‚îú‚îÄ‚îÄ .env                     # Vari√°veis de ambiente
‚îú‚îÄ‚îÄ .env copy                # C√≥pia das vari√°veis de ambiente (remover se n√£o usada)
‚îú‚îÄ‚îÄ .gitignore               # Arquivos/pastas a serem ignorados pelo Git
‚îú‚îÄ‚îÄ api_climatica.py         # Script para integra√ß√£o com a API clim√°tica
‚îú‚îÄ‚îÄ main.py                  # Script principal Python para rodar o sistema de backend (cole√ß√£o, DB, etc.)
‚îú‚îÄ‚îÄ README.md                # Este arquivo de documenta√ß√£o
‚îî‚îÄ‚îÄ requirements.txt         # Depend√™ncias Python do projeto
``


## ‚ñ∂Ô∏è Como Utilizar

### üíæ Instala√ß√£o

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone [https://github.com/Startup-FarmTech-Solutions/Sistema-de-Irrigacao-Inteligente-com-Sensores.git](https://github.com/Startup-FarmTech-Solutions/Sistema-de-Irrigacao-Inteligente-com-Sensores.git)
    cd Sistema-de-Irrigacao-Inteligente-com-Sensores
    ```
2.  **Crie e ative um ambiente virtual (altamente recomendado):**
    ```bash
    python -m venv .venv
    # No Windows:
    .venv\Scripts\activate
    # No Linux/macOS:
    source .venv/bin/activate
    ```
3.  **Instale as bibliotecas Python necess√°rias:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Configura√ß√£o de IPs (se necess√°rio para comunica√ß√£o local):**
    * **Firmware ESP32 (`sensor_solo/src/main.ino`):**
        * Localize a vari√°vel ou constante que define o IP do servidor Python (normalmente perto da linha 56, se a comunica√ß√£o for via WiFi).
        * Insira o endere√ßo IP da sua m√°quina host.
    * **Script Python (`sensor_solo/main.py`):**
        * Localize o m√©todo `def main()` (aproximadamente na linha 162).
        * Na vari√°vel `host` (ou similar, dependendo de como a conex√£o √© estabelecida), insira o endere√ßo IP da sua m√°quina host.
        * *Nota:* Se a comunica√ß√£o for apenas serial simulada no Wokwi para o Python local, a configura√ß√£o de IP pode n√£o ser necess√°ria neste script espec√≠fico.

### üîß Como Executar o C√≥digo

1.  **üìü Simula√ß√£o no Wokwi:**
    * Acesse o arquivo `diagram.json` localizado em `sensor_solo/`.
    * No Wokwi, clique em "Start Simulation".
    * Observe os dados dos sensores sendo exibidos no display LCD e no Serial Monitor/Plotter da simula√ß√£o.

2.  **üêç Execu√ß√£o do Backend Python (`main.py`):**
    * Certifique-se de que a simula√ß√£o no Wokwi esteja rodando e enviando dados pela porta serial (ou via rede, dependendo da sua configura√ß√£o).
    * Abra um terminal na raiz do projeto.
    * Execute o script principal Python:
        ```bash
        python main.py
        ```
    * Este script ir√° coletar os dados do Wokwi, process√°-los, interagir com a API clim√°tica, salvar no banco de dados SQLite e no `console_print.csv`.

3.  **üìä Rodar o Dashboard (Streamlit):**
    * Abra um novo terminal (mantendo o `main.py` e a simula√ß√£o Wokwi rodando).
    * Navegue at√© a pasta `dashboard`:
        ```bash
        cd dashboard
        ```
    * Execute o aplicativo Streamlit:
        ```bash
        streamlit run app.py
        ```
    * Uma nova aba no seu navegador ser√° aberta, acessando o dashboard em `http://localhost:8501` (ou uma porta similar).

---

## üóÉ Hist√≥rico de Lan√ßamentos

* **0.1.0 - 14/05/2025**
    * Inicializa√ß√£o do projeto base.
    * Simula√ß√£o inicial de sensores (DHT22, LDR) e rel√© no Wokwi.
    * Configura√ß√£o da comunica√ß√£o serial.
* **0.2.0 - 19/05/2025**
    * Integra√ß√£o com bot√µes para simula√ß√£o de nutrientes (P, K).
    * L√≥gica inicial de controle de irriga√ß√£o baseada em umidade e nutrientes.
    * Implementa√ß√£o b√°sica de coleta de dados Python e armazenamento.
* **0.3.0 - [Data Atual]**
    * Adi√ß√£o da integra√ß√£o com API clim√°tica (OpenWeather) para l√≥gica de irriga√ß√£o avan√ßada.
    * Migra√ß√£o do formato de dados coletados do console de `.json` para `.csv` (`ml/console_print.csv`).
    * Desenvolvimento e integra√ß√£o de modelo de Machine Learning (KNN) para sugest√£o de irriga√ß√£o.
    * Cria√ß√£o do dashboard interativo com Streamlit para visualiza√ß√£o e monitoramento de dados e previs√µes do ML.
    * Refatora√ß√£o da estrutura de pastas para melhor modularidade (connection, controller, model, ml).

---

## üìã Licen√ßa

<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://github.com/Startup-FarmTech-Solutions/Sistema-de-Irrigacao-Inteligente-com-Sensores.git">SISTEMA DE IRRIGA√á√ÉO INTELIGENTE</a> por <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://fiap.com.br">Fiap</a> est√° licenciado sob <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">Attribution 4.0 International</a>.</p>
